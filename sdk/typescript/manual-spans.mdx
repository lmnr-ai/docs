---
title: Manual Span Creation
description: Create spans manually with Laminar helpers in TypeScript.
---

# Manual Span Creation

## Laminar.startSpan(options)

Create a span without activating it. Use for spans you'll pass to other functions.

```typescript
const span = Laminar.startSpan({ name: 'custom_operation' });
try {
  const result = doWork();
  span.setAttributes({ 'result.count': result.length });
} finally {
  span.end();
}
```

**Parameters:**

| Name | Type | Default | Description |
|------|------|---------|-------------|
| `name` | `string` | — | Span name (required) |
| `input` | `any` | — | Span input (JSON-serialized) |
| `spanType` | `'DEFAULT' \| 'LLM' \| 'TOOL'` | `'DEFAULT'` | Span type |
| `tags` | `string[]` | — | Span tags |
| `userId` | `string` | — | User ID |
| `sessionId` | `string` | — | Session ID |
| `metadata` | `Record<string, any>` | — | Metadata |
| `parentSpanContext` | `string \| LaminarSpanContext` | — | Parent context |
| `context` | `Context` | — | OpenTelemetry context |

**Returns:** `Span`

**Note:** Not activated—caller must propagate context manually or use `withSpan`.

---

## Laminar.startActiveSpan(options)

Create and activate a span. Child spans nest automatically.

```typescript
const span = Laminar.startActiveSpan({ name: 'parent_operation' });
try {
  // Any spans created here are children of parent_operation
  await doWork();
} finally {
  span.end();
}
```

**Parameters:** Same as `startSpan`

**Returns:** `Span`

**Note:** Must call `span.end()` (recommend in `finally` block). Context push/pop handled automatically.

---

## Laminar.withSpan(span, fn, endOnExit?)

Activate an existing span for the duration of a function.

```typescript
const parentSpan = Laminar.startSpan({ name: 'parent' });

await Laminar.withSpan(parentSpan, async () => {
  // parentSpan is active here
  const child = Laminar.startSpan({ name: 'child' });
  await doWork();
  child.end();
});

parentSpan.end();
```

**Parameters:**

| Name | Type | Default | Description |
|------|------|---------|-------------|
| `span` | `Span` | — | Span to activate |
| `fn` | `() => T` | — | Function to execute |
| `endOnExit` | `boolean` | `false` | End span when function completes |

**Returns:** Return value of `fn` (or `Promise` if async)

**Note:** Records exception on error. If `endOnExit` is true, span ends after `fn` (awaited if Promise).
