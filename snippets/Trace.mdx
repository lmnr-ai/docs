import React, { useMemo } from "react";

export default function Trace({ id, traceId, spanId, host, height = 760, previewOnly = false }) {
  const baseStyles = {
    container: {
      border: "1px solid rgba(0,0,0,0.08)",
      background: "linear-gradient(145deg, rgba(0,0,0,0.02), rgba(0,0,0,0.01))",
      borderRadius: 12,
      color: "inherit",
      fontFamily: "Inter, system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif",
      boxShadow: "0 10px 40px rgba(0,0,0,0.1)",
      overflow: "hidden",
    },
    notice: {
      padding: 14,
      fontSize: 14,
      color: "#4b5563",
    },
    frame: {
      border: "none",
      width: "100%",
      display: "block",
    },
  };

  const traceIdentifier = traceId || id;
  const resolvedHost = useMemo(() => {
    const fallback = "https://laminar.sh";
    const detected = typeof window !== "undefined" ? window.location.origin : "";
    const base = host || detected || fallback;
    return base.endsWith("/") ? base.slice(0, -1) : base;
  }, [host]);

  const src = traceIdentifier
    ? `${resolvedHost}/shared/traces/${traceIdentifier}${spanId ? `?spanId=${spanId}` : ""}`
    : "";

  if (!traceIdentifier || previewOnly) {
    return (
      <div style={{ ...baseStyles.container, minHeight: 200 }}>
        <div style={baseStyles.notice}>
          Preview your trace embed here. Provide a `traceId` (and optional `spanId`) to render the shared trace viewer.
        </div>
      </div>
    );
  }

  return (
    <div style={{ ...baseStyles.container, minHeight: height }}>
      <iframe
        allow="clipboard-write; clipboard-read"
        src={src}
        style={{ ...baseStyles.frame, minHeight: height }}
        title="Laminar shared trace"
      />
    </div>
  );
}
