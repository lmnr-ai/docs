---
title: Custom Span Attributes
description: Setting custom attributes on spans for LLM instrumentation and metadata
---

## Overview

Custom span attributes allow you to add structured metadata to your traces. This is particularly useful for:

- **Manual LLM instrumentation** when calling APIs directly
- **Custom provider integration** for unsupported LLM services  
- **Token usage tracking** for cost analysis
- **Performance metrics** and debugging information

## LLM Span Attributes

When manually instrumenting LLM calls, certain attributes are required to make spans appear correctly in the Laminar UI.

### Required Attributes

These attributes must be set for a span to be recognized as an LLM span:

- `lmnr.span.type` – must be set to `'LLM'`
- `gen_ai.response.model` – the model name returned by the LLM API (e.g., `gpt-4o-mini`)
- `gen_ai.system` – the provider name (e.g., `openai`, `anthropic`)

### Optional Token Usage Attributes

For cost tracking and usage analysis:

- `gen_ai.usage.input_tokens` – number of input tokens
- `gen_ai.usage.output_tokens` – number of output tokens  
- `llm.usage.total_tokens` – total tokens used
- `gen_ai.usage.input_cost`, `gen_ai.usage.output_cost`, `gen_ai.usage.cost` – explicit cost values

<Note>
Laminar automatically calculates costs for major providers using token counts and model names. 
Explicit cost attributes are only needed for custom providers.
</Note>

## Setting Attributes

<Tabs>
<Tab title="JavaScript/TypeScript">

Use `Laminar.setSpanAttributes` to set attributes on the current span:

```javascript
import { Laminar, LaminarAttributes, observe } from '@lmnr-ai/lmnr';

await observe(
  {
    name: 'customLLMCall',
    spanType: 'LLM'
  }, 
  async (message: string) => {
    const response = await fetch('https://custom-llm.com/v1/completions', {
      method: 'POST',
      body: JSON.stringify({
        model: 'custom-model-1',
        messages: [{ role: 'user', content: message }]
      })
    }).then(res => res.json());

    // Set LLM-specific attributes
    Laminar.setSpanAttributes({
      [LaminarAttributes.PROVIDER]: 'custom-llm.com',
      [LaminarAttributes.REQUEST_MODEL]: 'custom-model-1',
      [LaminarAttributes.RESPONSE_MODEL]: response.model,
      [LaminarAttributes.INPUT_TOKEN_COUNT]: response.usage.input_tokens,
      [LaminarAttributes.OUTPUT_TOKEN_COUNT]: response.usage.output_tokens,
    });

    return response;
  }, 
  userMessage
);
```

### Available Attribute Constants

```javascript
import { LaminarAttributes } from '@lmnr-ai/lmnr';

// Common attributes
LaminarAttributes.PROVIDER           // 'gen_ai.system'
LaminarAttributes.REQUEST_MODEL      // 'gen_ai.request.model'  
LaminarAttributes.RESPONSE_MODEL     // 'gen_ai.response.model'
LaminarAttributes.INPUT_TOKEN_COUNT  // 'gen_ai.usage.input_tokens'
LaminarAttributes.OUTPUT_TOKEN_COUNT // 'gen_ai.usage.output_tokens'
```

</Tab>
<Tab title="Python">

Use `Laminar.set_span_attributes` to set attributes on the current span:

```python
from lmnr import Laminar, Attributes
import requests

messages = [{
    "role": "user", 
    "content": "What is the longest river in the world?"
}]

with Laminar.start_as_current_span(
    name="custom_llm_call",
    input=messages,
    span_type="LLM"
):
    response = requests.post(
        "https://api.custom-llm.com/v1/completions",
        json={
            "model": "custom-model-1",
            "messages": messages,
        },
    ).json()

    Laminar.set_span_output(response["choices"][0]["message"]["content"])
    
    # Set LLM-specific attributes
    Laminar.set_span_attributes({
        Attributes.PROVIDER: "custom-llm.com",
        Attributes.REQUEST_MODEL: "custom-model-1", 
        Attributes.RESPONSE_MODEL: response["model"],
        Attributes.INPUT_TOKEN_COUNT: response["usage"]["input_tokens"],
        Attributes.OUTPUT_TOKEN_COUNT: response["usage"]["output_tokens"],
    })
```

### Available Attribute Constants

```python
from lmnr import Attributes

# Common attributes
Attributes.PROVIDER           # 'gen_ai.system'
Attributes.REQUEST_MODEL      # 'gen_ai.request.model'
Attributes.RESPONSE_MODEL     # 'gen_ai.response.model'  
Attributes.INPUT_TOKEN_COUNT  # 'gen_ai.usage.input_tokens'
Attributes.OUTPUT_TOKEN_COUNT # 'gen_ai.usage.output_tokens'
```

</Tab>
</Tabs>

## Custom Metadata Attributes

Beyond LLM-specific attributes, you can add any custom metadata:

<Tabs>
<Tab title="JavaScript/TypeScript">

```javascript
import { Laminar, observe } from '@lmnr-ai/lmnr';

await observe({ name: 'processRequest' }, async () => {
  // Set custom attributes for debugging/analysis
  Laminar.setSpanAttributes({
    'custom.user_tier': 'premium',
    'custom.feature_flag': 'new_algorithm_enabled',
    'custom.processing_time_ms': Date.now() - startTime,
    'custom.cache_hit': cacheResult.hit
  });
  
  // Your application logic...
});
```

</Tab>
<Tab title="Python">

```python
from lmnr import Laminar

with Laminar.start_as_current_span(name="process_request"):
    # Set custom attributes for debugging/analysis  
    Laminar.set_span_attributes({
        "custom.user_tier": "premium",
        "custom.feature_flag": "new_algorithm_enabled", 
        "custom.processing_time_ms": processing_time,
        "custom.cache_hit": cache_result["hit"]
    })
    
    # Your application logic...
```

</Tab>
</Tabs>

## Best Practices

### Attribute Naming
- Use dot notation for hierarchical attributes: `custom.user.tier`
- Prefix custom attributes with `custom.` to avoid conflicts
- Use snake_case for consistency with OpenTelemetry standards

### Performance Considerations  
- Set attributes before span completion
- Avoid setting large objects as attributes (use JSON strings if needed)
- Use structured data types (strings, numbers, booleans) for better querying

### Common Use Cases

```javascript
// Performance tracking
Laminar.setSpanAttributes({
  'perf.duration_ms': executionTime,
  'perf.memory_mb': memoryUsage,
  'perf.cache_hit_ratio': cacheHitRatio
});

// Business context
Laminar.setSpanAttributes({
  'business.customer_tier': 'enterprise',
  'business.feature_enabled': true,
  'business.ab_test_variant': 'variant_b'
});

// Error context
Laminar.setSpanAttributes({
  'error.retry_count': retryAttempts,
  'error.fallback_used': true,
  'error.upstream_service': 'payment_api'
});
```

Custom span attributes provide powerful ways to enrich your traces with contextual information, making debugging and analysis much more effective.